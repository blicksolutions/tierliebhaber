{%- capture flickity_options -%}
{
  "prevNextButtons": false,
  "setGallerySize": {% if section.settings.show_fullscreen %}false{% else %}true{% endif %},
  "adaptiveHeight": {% if section.settings.show_fullscreen %}false{% else %}true{% endif %},
  "wrapAround": true,
  "dragThreshold": 15,
  "pauseAutoPlayOnHover": false,
  "autoPlay": {% if section.settings.autoplay %}{{ section.settings.cycle_speed | times: 1000 }}{% else %}false{% endif %},
  "pageDots": {% if section.blocks.size > 1 %}true{% else %}false{% endif %}
}
{%- endcapture -%}

<section id="section-{{ section.id }}" data-section-id="{{ section.id }}" data-section-type="slideshow">
  <div class="Slideshow Slideshow--versionA {% if section.settings.show_fullscreen %}Slideshow--fullscreen{% endif %}">
    <div class="Slideshow__Carousel {% if section.settings.show_arrow %}Slideshow__Carousel--withScrollButton{% endif %} Carousel Carousel--fadeIn {% if section.settings.show_fullscreen %}Carousel--fixed{% endif %} Carousel--insideDots"
         data-flickity-config='{{ flickity_options }}'>
      {%- for block in section.blocks -%}
        {%- capture slide_content -%}
          {%- comment -%}
            Implementation note: this is an art driven image selection so it would have been better to be able to use the "picture" tag instead. However,
            as the mobile and desktop image could have different aspect ratio, the image allocation space would not have work properly without explicitly
            distinguishing the two images, hence the two containers.
          {%- endcomment -%}

          {%- assign mobile_image = block.settings.mobile_image | default: block.settings.image -%}

          {%- if mobile_image -%}
            <div class="Slideshow__ImageContainer {% if block.settings.apply_overlay %}Image--contrast{% endif %} {% unless section.settings.show_fullscreen %}AspectRatio{% endunless %} hidden-tablet-and-up"
                 style="{% unless section.settings.show_fullscreen %}--aspect-ratio: {{ mobile_image.aspect_ratio }};{% endunless %} background-image: url({{ mobile_image | img_url: '1x1', format: 'jpg' }})">

                <script>
                    console.log("{{ block.settings.mobile_image }}")
                </script>
                <img class="Slideshow__Image"
                     src="{{ block.settings.mobile_image | img_url: 'x800'}}"
                     alt="{{ mobile_image.alt | escape }}"
                     >

                <noscript>
                  <img class="Slideshow__Image" src="{{ mobile_image | img_url: 'x800' }}" alt="{{ mobile_image.alt | escape }}">
                </noscript>
            </div>
          {%- endif -%}

          {%- if block.settings.image -%}
            <div class="Slideshow__ImageContainer {% if block.settings.apply_overlay %}Image--contrast{% endif %} {% unless section.settings.show_fullscreen %}AspectRatio AspectRatio--withFallback{% endunless %} hidden-phone"
                 style="{% unless section.settings.show_fullscreen %}padding-bottom: {{ 100.0 | divided_by: block.settings.image.aspect_ratio }}%; --aspect-ratio: {{ block.settings.image.aspect_ratio }};{% endunless %} background-image: url({{ block.settings.image | img_url: '1x1', format: 'jpg' }})">
              {% assign image_url = block.settings.image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' %}

              <img class="Slideshow__Image Image--lazyLoad hide-no-js"
                   data-src="{{ image_url }}"
                   data-optimumx="1.2"
                   data-widths="[400, 600, 800, 1000, 1200, 1400, 1600, 1800, 2000, 2200]"
                   data-sizes="auto"
                   alt="{{ block.settings.image.alt | escape }}">

              <noscript>
                <img class="Slideshow__Image" src="{{ block.settings.image | img_url: '1000x' }}" alt="{{ block.settings.image.alt | escape }}">
              </noscript>
            </div>
          {%- else -%}
            <div class="Slideshow__ImageContainer {% if block.settings.apply_overlay %}Image--contrast{% endif %} {% if section.settings.show_fullscreen %}PlaceholderBackground{% endif %} PlaceholderSvg--dark">
              {%- capture placeholder -%}{% cycle 'lifestyle-1', 'lifestyle-2' %}{%- endcapture -%}
              {{ placeholder | placeholder_svg_tag: 'Slideshow__Image PlaceholderBackground__Svg' }}
            </div>
          {%- endif -%}

          {%- capture slideshow_content -%}
            {%- if block.settings.subheading != blank -%}
              <h3 class="SectionHeader__SubHeading Heading u-h6">{{ block.settings.subheading | escape }}</h3>
            {%- endif -%}

            {%- if block.settings.title != blank -%}
              <h2 class="SectionHeader__Heading SectionHeader__Heading--emphasize Heading u-h1">{{ block.settings.title | escape }}</h2>
            {%- endif -%}

            {%- if block.settings.button_1_text != blank and block.settings.button_2_text != blank -%}
              {%- assign has_two_buttons = true -%}
            {%- else -%}
              {%- assign has_two_buttons = false -%}
            {%- endif -%}

            {%- if block.settings.button_1_text != blank or block.settings.button_2_text != blank -%}
              <div class="SectionHeader__ButtonWrapper">
                <div class="ButtonGroup ButtonGroup--spacingSmall {% if has_two_buttons %}ButtonGroup--sameSize{% endif %}">
                  {%- if block.settings.button_1_text != blank -%}
                    {%- capture button_styles -%}
                      --hero-button_color: {{ block.settings.button_text_color }};
                      --hero-button-background-color: {{ block.settings.button_background }};
                      --hero-button-font-size: {{ block.settings.button_font_size }}px;
                      --hero-button-font-weight: {{ block.settings.button_font_weight }}; 
                    {%- endcapture -%}
                    <a 
                      class="ButtonGroup__Item Button HeroButton"
                      href="{{ block.settings.button_1_link }}" 
                      style="{{ button_styles | strip_newlines | replace: ' ', '' }}--hero-button-font-family: {{ block.settings.button_font | escape }};"
                      >
                      {{ block.settings.button_1_text | escape }}
                      {{ block.settings.button_font.family }}
                    </a>
                  {%- endif -%}

                  {%- if block.settings.button_2_text != blank -%}
                    <a 
                      class="ButtonGroup__Item Button HeroButton"
                      href="{{ block.settings.button_2_link }}" 
                      style="{{ button_styles | strip_newlines | replace: ' ', '' }}--hero-button-font-family: {{ block.settings.button_font | escape }};""
                      >
                      {{ block.settings.button_2_text | escape }}
                    </a>
                  {%- endif -%}
                </div>
              </div>
            {%- endif -%}
          {%- endcapture -%}

          {%- if slideshow_content != blank -%}
            <div
              class="Slideshow__Content Slideshow__Content--{{ block.settings.content_position }}"
              style="--offset-top-mobile: {{ block.settings.content_offset_mobile_top }}; --offset-left-mobile: {{ block.settings.content_offset_mobile_left }}; --offset-top-desktop: {{ block.settings.content_offset_desktop_top }}; --offset-left-desktop: {{ block.settings.content_offset_desktop_left }};"
              >
              <header class="SectionHeader">
                {{ slideshow_content }}
              </header>
            </div>
          {%- endif -%}
        {%- endcapture -%}

        {%- comment -%}This code allows to cover a common use case where merchant would like to have a clickable image{%- endcomment -%}

        {%- if block.settings.button_1_text == blank and block.settings.button_1_link != blank -%}
          <a href="{{ block.settings.button_1_link }}" id="Slide{{ block.id }}" class="Slideshow__Slide Carousel__Cell {% if forloop.first %}is-selected{% endif %}" {% if forloop.first %}style="visibility: visible"{% endif %} data-slide-index="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
            {{- slide_content -}}
          </a>
        {%- else -%}
          <div id="Slide{{ block.id }}" class="Slideshow__Slide Carousel__Cell {% if forloop.first %}is-selected{% endif %}" {% if forloop.first %}style="visibility: visible"{% endif %} data-slide-index="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
            {{- slide_content -}}
          </div>
        {%- endif -%}
      {%- endfor -%}
    </div>

    {%- if section.settings.show_arrow -%}
      <button data-href="#section-{{ section.id }}-end" class="Slideshow__ScrollButton RoundButton RoundButton--medium" aria-label="{{ 'general.accessibility.scroll_to_content' | t }}" data-animate-bottom>
        {%- render 'icon' with 'arrow-bottom' -%}
      </button>
    {%- endif -%}
  </div>

  <div class="Slideshow--versionB">
    <img class="Slideshow--versionB__background" src="https://cdn.shopify.com/s/files/1/0587/2746/5119/files/Dental-Spray-5.jpg?v=1714417937" alt="Dog and owner">
    <div class="Slideshow--versionB__content">
      <svg class="Slideshow--versionB__content__background--mobile" xmlns="http://www.w3.org/2000/svg" width="1000" height="1000" viewBox="0 0 375 354" fill="none">
      <path d="M456.219 173.202C456.219 230.435 465.54 363.222 420.439 401.949C371.261 444.178 139.704 458 62.0647 458C-86.7772 458 -102.984 336.269 -102.984 216.628C-102.984 96.9878 -109.984 10.9999 166.518 -7.62939e-05C244.767 -7.62939e-05 323.685 7.39172 372.919 50.2017C434.091 100.698 456.219 116.458 456.219 173.202Z" fill="#F2F8F5"/>
      </svg>
      <svg class="Slideshow--versionB__content__background--desktop" xmlns="http://www.w3.org/2000/svg" width="1440" height="369" viewBox="0 0 1440 369" fill="none">
      <path d="M792 108C459.5 -54.5003 100 -15.0001 -25.5 108V381.5L1489 425V47.5001C1361.83 195.333 1124.5 270.5 792 108Z" fill="#F2F8F5"/>
      </svg>
      <img class="Slideshow--verisonB__comparison-image" src="https://cdn.shopify.com/s/files/1/0587/2746/5119/files/Vorher_Nachher_TLH_2.png?v=1722515107" alt="before and after">
      <div class="Slideshow--versionB__content-box">
        <div class="Slideshow--verisonB__testimonials">
          {% render 'bs-icon-profile-bubbles' %}
          <span>
            <strong>11.000+ Hundebesitzer</strong> berichten von sichtbaren Verbesserungen <br/> und hervorragender Wirkung
          </span>
        </div>
        <h2 class="Slideshow--versionB__title">
          Kinderleichte Zahnpflege für Hunde!
        </h2>
        <p class="Slideshow--versionB__description">
          Einfach aufs Futter sprühen und Zahnbelag selbst entfernen… 100% natürlich dank probiotischen Mikroorganismen!
        </p>
        <a href="https://tierliebhaber.de/collections/zahnpflege/products/dentalspray" class="Slideshow--versionB__cta-button Button Button--primary">Zum Dentalspray</a>
      </div>
    </div>
  </div>

  <span id="section-{{ section.id }}-end" class="Anchor"></span>
</section>

<style>
  #section-{{ section.id }} .Heading,
   #section-{{ section.id }} .flickity-page-dots {
    color: {{ section.settings.text_color }};
  }

  #section-{{ section.id }} .Button {
    box-shadow: 0px 4px 16px 2px rgba(0, 0, 0, 0.1);
    text-transform: none;
    border-radius: 8px;
  }

  #section-{{ section.id }} .Button::before {
    display: none;
  }
</style>

{% schema %}
{
  "name": "Slideshow",
  "class": "shopify-section--slideshow",
  "max_blocks": 5,
  "settings": [
    {
      "type": "checkbox",
      "id": "show_fullscreen",
      "label": "Show full-screen images",
      "info": "If enabled, images will be resized to fit the entire screen.",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_arrow",
      "label": "Show bottom arrow",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto rotate between slides",
      "default": true
    },
    {
      "type": "range",
      "id": "cycle_speed",
      "min": 3,
      "max": 8,
      "step": 1,
      "unit": "sec",
      "label": "Change slides every",
      "default": 5
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button text",
      "default": "#363636"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button background",
      "default": "#ffffff"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "1800 x 800px .jpg recommended"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile image",
          "info": "750 x 1100px .jpg recommended. If none is set, desktop image will be cropped."
        },
        {
          "type": "checkbox",
          "id": "apply_overlay",
          "label": "Apply overlay on image",
          "info": "This can improve text visibility.",
          "default": true
        },
        {
          "type": "range",
          "id": "content_offset_mobile_left",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 50,
          "label": "Content Offset Left (mobile)"
        },
        {
          "type": "range",
          "id": "content_offset_mobile_top",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 50,
          "label": "Content Offset Top (mobile)"
        },
        {
          "type": "range",
          "id": "content_offset_desktop_left",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 50,
          "label": "Content Offset Left (desktop)"
        },
        {
          "type": "range",
          "id": "content_offset_desktop_top",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 50,
          "label": "Content Offset Top (desktop)"
        },
        {
          "type": "select",
          "id": "content_position",
          "label": "Content position",
          "options": [
            {
              "value": "middleLeft",
              "label": "Middle left"
            },
            {
              "value": "middleCenter",
              "label": "Middle center"
            },
            {
              "value": "middleRight",
              "label": "Middle right"
            },
            {
              "value": "bottomLeft",
              "label": "Bottom left"
            },
            {
              "value": "bottomCenter",
              "label": "Bottom center"
            },
            {
              "value": "bottomRight",
              "label": "Bottom right"
            }
          ],
          "default": "middleCenter"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Sub-heading",
          "default": "Slide title"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Heading",
          "default": "Tell your story"
        },
        {
          "type": "header",
          "content": "Button 1"
        },
        {
          "type": "text",
          "id": "button_1_text",
          "label": "Text"
        },
        {
          "type": "url",
          "id": "button_1_link",
          "label": "Link"
        },
        {
          "type": "header",
          "content": "Button 2"
        },
        {
          "type": "text",
          "id": "button_2_text",
          "label": "Text"
        },
        {
          "type": "url",
          "id": "button_2_link",
          "label": "Link"
        },
        {
          "type": "header",
          "content": "Button Style"
        },
        {
          "type": "select",
          "id": "button_font",
          "label": "Button Font",
          "options": [
            {
              "value": "Poppins",
              "label": "Poppins"
            },
            {
              "value": "Sweet Purple",
              "label": "Sweet Purple"
            }
          ],
          "default": "Poppins"
        },
        {
          "type": "range",
          "id": "button_font_size",
          "min": 12,
          "max": 60,
          "step": 1,
          "unit": "px",
          "label": "Font Size",
          "default": 35
        },
        {
          "type": "range",
          "id": "button_font_weight",
          "min": 100,
          "max": 900,
          "step": 100,
          "label": "Font Weight",
          "default": 400
        },
        {
          "type": "color",
          "id": "button_text_color",
          "label": "Text Color",
          "default": "#000"
        },
        {
          "type": "color",
          "id": "button_background",
          "label": "Background Color",
          "default": "#fff"
        }
      ]
    }
  ],
  "presets": [
    {
      "category": "Image",
      "name": "Slideshow",
      "settings": {},
      "blocks": [
        {
          "type": "image"
        },
        {
          "type": "image"
        }
      ]
    }
  ]
}
{% endschema %}
