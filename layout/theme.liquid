{%comment %}
<!doctype html>
<html class="no-js" lang="{{ shop.locale }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">

    <!-- Theme color -->
    <meta name="theme-color" content="{{ settings.accent_color }}">

    <!-- Google site verification (keep both if both are in use) -->
    <meta name="google-site-verification" content="QZiR1WxDnZAKrxARkf6DQjhHzK1Y3t4Oo5I1TMO2Sgo">
    <meta name="google-site-verification" content="Yq9dF4MhfrxG4y9GADuu6whPXKYTFZ4vQ3O52SZWsas">

    <!-- CRITICAL COOKIE BLOCKING - Add before any other scripts -->
    <script>
      // Block problematic cookies before they can be set
      (function() {
        // Override document.cookie setter to block marketing cookies before consent
        var originalCookieDescriptor = Object.getOwnPropertyDescriptor(Document.prototype, 'cookie') ||
                                     Object.getOwnPropertyDescriptor(HTMLDocument.prototype, 'cookie');
        
        if (originalCookieDescriptor && originalCookieDescriptor.configurable) {
          Object.defineProperty(document, 'cookie', {
            get: function() {
              return originalCookieDescriptor.get.call(document);
            },
            set: function(val) {
              // List of cookies to block before consent
              var blockedCookies = [
                'data-timeout',           // RevenueHunt - from your log
                '_shopify_test',          // Shopify tracking
                'shopify_pay_redirect',   // Shopify Pay tracking
                'keep_alive',             // Shopify analytics
                '_shop_app_essential'     // Shop Pay tracking
              ];
              
              var cookieName = val.split('=')[0].trim();
              var shouldBlock = false;
              
              // Check if this cookie should be blocked
              for (var i = 0; i < blockedCookies.length; i++) {
                if (cookieName.indexOf(blockedCookies[i]) === 0) {
                  shouldBlock = true;
                  break;
                }
              }
              
              // Only set cookie if consent exists and marketing is allowed, OR if it's not a blocked cookie
              if (!shouldBlock || 
                  (window.Cookiebot && window.Cookiebot.consent && window.Cookiebot.consent.marketing)) {
                originalCookieDescriptor.set.call(document, val);
              } else {
                console.log('Blocked cookie before consent:', cookieName);
              }
            },
            configurable: true
          });
        }
      })();
    </script>

    <!-- Cookiebot MUST be first script after cookie blocking -->
    <script id="Cookiebot"
            src="https://consent.cookiebot.com/uc.js"
            data-cbid="a4aa9c1a-9639-4e9f-8a23-4aef9c37b3cc"
            data-blockingmode="auto"
            type="text/javascript">
    </script>

    <!-- Core CSS (functional - no gating needed) -->
    <link rel="stylesheet" href="{{ 'theme.css' | asset_url }}">
    <link rel="stylesheet" href="{{ 'bs-custom.css' | asset_url }}">
    <link rel="stylesheet" href="{{ 'bs-mobile-sidebar-nav.css' | asset_url }}">
    <link rel="stylesheet" href="{{ 'recommended-search-products.css' | asset_url }}">

    <!-- AB / landing CSS - GATED (these likely have tracking) -->
    <link rel="stylesheet" href="{{ 'bs-ab-tlh-010.css' | asset_url }}" data-cookieconsent="marketing">
    <link rel="stylesheet" href="{{ 'ds-op-lp-3.css' | asset_url }}" data-cookieconsent="marketing">

    <!-- Slick (functional - keep ungated if only used for UI) -->
    <link rel="stylesheet" href="{{ 'slick.css' | asset_url }}">
    <link rel="stylesheet" href="{{ 'slick-theme.css' | asset_url }}">

    <!-- Swiper (functional - keep ungated if only used for UI) -->
    <link rel="stylesheet" href="{{ 'swiper-bundle.min.css' | asset_url }}">

    {% if page_description %}
      <meta name="description" content="{{ page_description | escape }}">
    {% endif %}
    <link rel="canonical" href="{{ canonical_url }}">
    {% if settings.favicon %}
      <link rel="shortcut icon" href="{{ settings.favicon | img_url: '96x' }}" type="image/png">
    {% endif %}

    <!-- NoIndex on pages with vendors not known to the shop -->
    {%- if request.path == '/collections/vendors' -%}
      {%- assign lowercase_vendors = shop.vendors | join: ',' | downcase | split: ',' -%}
      {%- assign lowercase_input = collection.title | downcase -%}
      {%- unless lowercase_vendors contains lowercase_input -%}
        <meta name="robots" content="noindex">
      {%- endunless -%}
    {%- endif -%}

    <!-- Title -->
    <title>
      {{ page_title }}
      {% if current_tags %}
        {% assign meta_tags = current_tags | join: ', ' %} – {{ 'general.meta.tags' | t: tags: meta_tags }}
      {% endif %}
      {% if current_page != 1 %} – {{ 'general.meta.page' | t: page: current_page }}{% endif %}
      {% unless page_title contains shop.name %} – {{ shop.name }}{% endunless %}
    </title>

    {% render 'social-meta-tags' %}
    {% render 'css-variables' %}

    <!-- Shopify header content -->
    {{ content_for_header }}
    {% render 'cookie-consent' %}

    <!-- Replo (likely has tracking - GATE IT) -->
    <script type="text/plain" data-cookieconsent="marketing">
      {% render 'replo-head' %}
    </script>

    <!-- Rapid Search (if purely functional, can stay ungated) -->
    {% render 'rapid-search-settings' %}

    <!-- ALL AB TESTING & MARKETING SCRIPTS - PROPERLY GATED -->
    <script type="text/plain" data-cookieconsent="marketing" src="{{ 'bs-ab-tlh001.js' | asset_url }}"></script>
    <script type="text/plain" data-cookieconsent="marketing" src="{{ 'bs-ab-tlh004.js' | asset_url }}"></script>
    <script type="text/plain" data-cookieconsent="marketing" src="{{ 'bs-ab-tlh-009.js' | asset_url }}"></script>
    <script type="text/plain" data-cookieconsent="marketing" src="{{ 'bs-ab-tlh-010.js' | asset_url }}"></script>
    <script type="text/plain" data-cookieconsent="marketing" src="{{ 'bs-ab-tlh-011.js' | asset_url }}"></script>
    <script type="text/plain" data-cookieconsent="marketing" src="{{ 'bs-ab-tlh-025.js' | asset_url }}"></script>

    <!-- DE visitor flag for ABlyft - GATED -->
    <script type="text/plain" data-cookieconsent="marketing">
      fetch('/browsing_context_suggestions.json')
        .then(function(r){ return r.json(); })
        .then(function(json){ window.isDeVisitor = json && json.detected_values && json.detected_values.country && json.detected_values.country.handle === "DE"; })
        .catch(function(){ window.isDeVisitor = false; });
    </script>

    <!-- ABlyft Snippet - GATED -->
    <script type="text/plain" data-cookieconsent="marketing" src="https://cdn.ablyft.com/s/55886406.js"></script>
    <script type="text/plain" data-cookieconsent="marketing">window.ablyft = window.ablyft || [];</script>

    <!-- TLH-026 custom goal snippet - GATED -->
    <script type="text/plain" data-cookieconsent="marketing">
      document.addEventListener('DOMContentLoaded', function() {
        var el = document.querySelector('.Search__Inner');
        if (!el || !window.ablyft) return;
        el.addEventListener('click', function() {
          window.ablyft.push({ eventType: 'custom', eventName: 'tlh-026-clicks-on-searchbar', eventValue: 1 });
        });
      });
    </script>

    <!-- Awin Implementation - GATED -->
    <script type="text/plain" data-cookieconsent="marketing">
      (function() {
        window.AWIN = window.AWIN || {};
        AWIN.Tracking = AWIN.Tracking || {};
        AWIN.Tracking.Consent = AWIN.Tracking.Consent || { setAdvertiserConsentStatus: function(){} };

        var cookies = document.cookie || '';
        var prefix = 'CookieConsent=';
        var begin = cookies.indexOf('; ' + prefix);
        if (begin === -1) {
          begin = cookies.indexOf(prefix);
          if (begin !== 0) return;
        } else {
          begin += 2;
        }
        var end = cookies.indexOf(';', begin);
        if (end === -1) end = cookies.length;
        var val = decodeURI(cookies.substring(begin + prefix.length, end));
        var fullConsent = ['necessary:true','preferences:true','statistics:true','marketing:true'].every(function(p){ return val.indexOf(p) > -1; });
        AWIN.Tracking.Consent.setAdvertiserConsentStatus(!!fullConsent);
      })();
    </script>

    <!-- Amazon Ad Tag on home only - GATED -->
    {% if template.name == 'index' %}
      <script type="text/plain" data-cookieconsent="marketing">
        !function(w,d,s,t,a){if(w.amzn)return;w.amzn=a=function(){w.amzn.q.push([arguments,(new Date).getTime()])};a.q=[];a.version="0.0";s=d.createElement("script");s.src="https://c.amazon-adsystem.com/aat/amzn.js";s.id="amzn-pixel";s.async=true;t=d.getElementsByTagName("script")[0];t.parentNode.insertBefore(s,t)}(window,document);
        amzn("setRegion", "EU");
        amzn("addTag", "9ed9779f-1bce-49a3-a8de-4434d6a6c0be");
        amzn("trackEvent", "PageView");
      </script>
    {% endif %}

    <!-- Feature flags / globals (functional - no consent needed) -->
    <script>
      window.SLIDECART_DISABLE = true;
      window.experiments = { data: { product: { id: {{ product.id | json }}, title: {{ product.title | json }} } } };
      window.enable_superchat = {{ settings.enable_superchat }};
      window.superchat_delay = {{ settings.superchat_delay | times: 1000 }};
    </script>

    {% render 'head-styles', layout: 'theme' %}

    <!-- IMPORTANT: lazySizes config MUST be before lazySizes script -->
    <script>
      window.lazySizesConfig = {
        loadHidden: false,
        hFac: 0.5,
        expFactor: 2,
        ricTimeout: 150,
        lazyClass: 'Image--lazyLoad',
        loadingClass: 'Image--lazyLoading',
        loadedClass: 'Image--lazyLoaded'
      };
    </script>
    <script src="{{ 'lazysizes.min.js' | asset_url }}" async></script>

    <!-- Polyfills first, then vendors (functional - no consent needed) -->
    <script src="https://cdn.polyfill.io/v3/polyfill.min.js?unknown=polyfill&features=fetch,Element.prototype.closest,Element.prototype.remove,Element.prototype.classList,Array.prototype.includes,Array.prototype.fill,Object.assign,CustomEvent,IntersectionObserver,IntersectionObserverEntry,URL" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" defer></script>
    <script src="{{ 'libs.min.js' | asset_url }}" defer></script>
    <script src="{{ 'slick.min.js' | asset_url }}" defer></script>
    <script src="{{ 'swiper-bundle.min.js' | asset_url }}" defer></script>

    <!-- Theme & custom scripts (functional - no consent needed) -->
    <script src="{{ 'theme.min.js' | asset_url }}" defer></script>
    <script src="{{ 'bs-load-third-party-scripts.js' | asset_url }}" defer></script>
    <script src="{{ 'bs-subscription-callout.js' | asset_url }}" defer></script>
    <script src="{{ 'bs-sticky-atc.js' | asset_url }}" defer></script>
    <script src="{{ 'bs-mobile-sidebar-nav.js' | asset_url }}" defer></script>
    <script src="{{ 'bs-cart-drawer.js' | asset_url }}" defer></script>
    <script src="{{ 'search-manipulation.js' | asset_url }}" defer></script>
    <script src="{{ 'bs-dentalspray-redirect.js' | asset_url }}" defer></script>

    <!-- Customer area assets (Shopify standard - functional) -->
    {% if template == 'customers/addresses' %}
      <script src="{{ 'shopify_common.js' | shopify_asset_url }}" defer></script>
      <script src="{{ 'customer_area.js' | shopify_asset_url }}" defer></script>
    {% endif %}

    <!-- IMPORTANT: Check head-scripts include for marketing content -->
    {% comment %}
    WARNING: If 'head-scripts' contains any marketing/tracking scripts,
    you need to either:
    1. Remove marketing scripts from that include, OR
    2. Gate the entire include like this:
    <script type="text/plain" data-cookieconsent="marketing">
      {% render 'head-scripts', layout: 'theme' %}
    </script>
    {% endcomment %}
    {% render 'head-scripts', layout: 'theme' %}

    {% render 'microdata-schema' %}
    {% include 'ufe-offer' %}

    <!-- RevenueHunt Quiz - GATE THIS (it's setting data-timeout cookie) -->
    <script type="text/plain" data-cookieconsent="marketing">
      // RevenueHunt embed script - this was setting cookies before consent
      (function() {
        var script = document.createElement('script');
        script.src = 'https://admin.revenuehunt.com/embed.js?shop=tierliebhaber-animagus.myshopify.com';
        document.head.appendChild(script);
      })();
    </script>

    <!-- Enhanced consent change handler with Shopify tracking control -->
    <script>
      (function() {
        // Disable Shopify Analytics before consent
        window.ShopifyAnalytics = window.ShopifyAnalytics || {};
        window.ShopifyAnalytics.lib = window.ShopifyAnalytics.lib || {};
        window.ShopifyAnalytics.lib.track = function() {
          if (window.Cookiebot && window.Cookiebot.consent && window.Cookiebot.consent.marketing) {
            // Only track if marketing consent is given
            if (window.originalShopifyTrack) {
              return window.originalShopifyTrack.apply(this, arguments);
            }
          }
          console.log('Shopify tracking blocked - no marketing consent');
        };

        function clearMarketingStorage() {
          try {
            var keys = [
              'TriplePixel','TriplePixelU','klaviyoOnsite','__kl_key','__kla_id',
              'loyaltylion_persistent_data','___ELEVAR_GTM_SUITE--userId',
              '___ELEVAR_GTM_SUITE--params','___ELEVAR_GTM_SUITE--sessionId',
              '___ELEVAR_GTM_SUITE--sessionCount','___ELEVAR_GTM_SUITE--lastDlPushTimestamp',
              '__gemx_campaign_data','__gemx_campaign_template','_replo_sid','smile_shopify_data',
              '_ga','_gid','_gat','_fbp','_fbc', 
              'ablyft_', 'awin_', '_klaviyo',
              'data-timeout', // RevenueHunt
              'shopify_pay_redirect', // Shopify Pay
              'keep_alive' // Shopify analytics
            ];
            
            keys.forEach(function(k){ 
              try{ 
                localStorage.removeItem(k);
                sessionStorage.removeItem(k);
                // Remove cookies that start with these prefixes
                if (k.endsWith('_')) {
                  document.cookie.split(';').forEach(function(cookie) {
                    var name = cookie.split('=')[0].trim();
                    if (name.indexOf(k) === 0) {
                      document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/; domain=' + window.location.hostname;
                      document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/;';
                      document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/; domain=.de';
                    }
                  });
                } else {
                  // Remove specific cookie
                  document.cookie = k + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/; domain=' + window.location.hostname;
                  document.cookie = k + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/;';
                  document.cookie = k + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/; domain=.de';
                }
              }catch(e){} 
            });
          } catch(e) {
            console.warn('Error clearing marketing storage:', e);
          }
        }

        function checkConsentAndAct() {
          // Clear storage when marketing consent is withdrawn
          if (window.Cookiebot && window.Cookiebot.consent && window.Cookiebot.consent.marketing === false) {
            clearMarketingStorage();
          }
          
          // Enable/disable Shopify tracking based on consent
          if (window.Cookiebot && window.Cookiebot.consent) {
            if (window.Cookiebot.consent.marketing && window.originalShopifyTrack) {
              window.ShopifyAnalytics.lib.track = window.originalShopifyTrack;
            }
          }
        }

        // Store original Shopify tracking function
        if (window.ShopifyAnalytics && window.ShopifyAnalytics.lib && window.ShopifyAnalytics.lib.track) {
          window.originalShopifyTrack = window.ShopifyAnalytics.lib.track;
        }

        // Run on all consent events
        if (window.addEventListener) {
          window.addEventListener('CookiebotOnLoad', checkConsentAndAct);
          window.addEventListener('CookiebotOnAccept', checkConsentAndAct);
          window.addEventListener('CookiebotOnDecline', checkConsentAndAct);
          window.addEventListener('CookiebotOnDialogInit', checkConsentAndAct);
        }

        // Fallback for older browsers
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(checkConsentAndAct, 1000);
        });
      })();
    </script>
  </head>

  {%- capture classes -%}features--heading-{{ settings.heading_size }}{%- endcapture -%}
  {%- if settings.uppercase_heading -%}{% assign classes = classes | append: ' features--heading-uppercase' %}{% endif -%}
  {%- if settings.product_show_price_on_hover -%}{% assign classes = classes | append: ' features--show-price-on-hover' %}{% endif -%}
  {%- if settings.show_page_transition -%}{% assign classes = classes | append: ' features--show-page-transition' %}{% endif -%}
  {%- if settings.show_button_transition -%}{% assign classes = classes | append: ' features--show-button-transition' %}{% endif -%}
  {%- if settings.show_image_zooming -%}{% assign classes = classes | append: ' features--show-image-zooming' %}{% endif -%}
  {%- if settings.show_element_staggering -%}{% assign classes = classes | append: ' features--show-element-staggering' %}{% endif -%}

  {%- assign shopCurrencySymbol = 100 | money | replace: '1.00' | replace: '1,00' -%}

  <body
    class="prestige--v4 {{ classes }} {% if template.directory %}template-{{ template.directory | handle }}{% endif %} template-{{ template.name | handle }}"
    data-currency-symbol="{{ shopCurrencySymbol }}"
  >
    <a class="PageSkipLink u-visually-hidden" href="#main">{{ 'header.navigation.skip_to_content' | t }}</a>
    <span class="LoadingBar"></span>
    <div class="PageOverlay"></div>
    {% if settings.show_page_transition %}<div class="PageTransition"></div>{% endif %}

    {% section 'popup' %}
    {% section 'sidebar-menu' %}
    {% if template != 'cart' %}{% section 'cart-drawer' %}{% endif %}

    <div class="PageContainer">
      {% section 'announcement' %}
      {% section 'header' %}

      <main id="main" role="main">
        {{ content_for_layout }}
      </main>

      {% section 'footer' %}
    </div>

    <!-- Bootstrapping & env flags (functional - no consent needed) -->
    <script>
      (function () {
        window.theme = {
          pageType: {{ request.page_type | json }},
          moneyFormat: {{ shop.money_format | json }},
          moneyWithCurrencyFormat: {{ shop.money_with_currency_format | json }},
          productImageSize: {{ settings.product_image_size | json }},
          searchMode: {{ settings.search_mode | json }},
          showPageTransition: {{ settings.show_page_transition | json }},
          showElementStaggering: {{ settings.show_element_staggering | json }},
          showImageZooming: {{ settings.show_image_zooming | json }}
        };

        window.routes = {
          rootUrl: {{ routes.root_url | json }},
          rootUrlWithoutSlash: {% if routes.root_url == '/' %}''{% else %}{{ routes.root_url | json }}{% endif %},
          cartUrl: {{ routes.cart_url | json }},
          cartAddUrl: {{ routes.cart_add_url | json }},
          cartChangeUrl: {{ routes.cart_change_url | json }},
          searchUrl: {{ routes.search_url | json }},
          productRecommendationsUrl: {{ routes.product_recommendations_url | json }}
        };

        window.languages = {
          cartAddNote: {{ 'cart.general.add_note' | t | json }},
          cartEditNote: {{ 'cart.general.edit_note' | t | json }},
          productImageLoadingError: {{ 'product.slideshow.image_loading_error' | t | json }},
          productFormAddToCart:
            {% if product.template_suffix == 'pre-order' %}
              {{ 'product.form.pre_order' | t | json }}
            {% elsif product.template_suffix == 'donation' %}
              {{ 'product.form.add_to_cart_donation' | t | json }}
            {% else %}
              {{ 'product.form.add_to_cart' | t | json }}
            {% endif %},
          productFormUnavailable: {{ 'product.form.unavailable' | t | json }},
          productFormSoldOut: {{ 'product.form.sold_out' | t | json }},
          shippingEstimatorOneResult: {{ 'cart.shipping_estimator.one_result_title' | t | json }},
          shippingEstimatorMoreResults: {{ 'cart.shipping_estimator.more_results_title' | t | json }},
          shippingEstimatorNoResults: {{ 'cart.shipping_estimator.no_results_title' | t | json }}
        };

        window.Shopify = window.Shopify || {};
        {% if customer %}window.Shopify.isUserLoggedIn = true;{% else %}window.Shopify.isUserLoggedIn = false;{% endif %}

        document.documentElement.className = document.documentElement.className.replace('no-js', 'js');
        document.documentElement.style.setProperty('--window-height', window.innerHeight + 'px');

        (function() {
          var sticky = (window.CSS && window.CSS.supports('(position: sticky) or (position: -webkit-sticky)'));
          var hover = window.matchMedia && window.matchMedia('(-moz-touch-enabled: 1), (hover: none)').matches;
          document.documentElement.className += sticky ? ' supports-sticky' : ' no-supports-sticky';
          document.documentElement.className += hover ? ' no-supports-hover' : ' supports-hover';
        }());

        window.onpageshow = function() {
          if (window.theme.showPageTransition) {
            var pageTransition = document.querySelector('.PageTransition');
            if (pageTransition) {
              pageTransition.style.visibility = 'visible';
              pageTransition.style.opacity = '0';
            }
          }
          document.documentElement.dispatchEvent(new CustomEvent('cart:refresh', { bubbles: true }));
        };
      })();
    </script>

    <!-- Policy page: inject Cookie Declaration -->
    {% if request.page_type == 'policy' %}
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          var t = document.querySelector('.shopify-policy__title');
          var b = document.querySelector('.shopify-policy__body');
          if (t) t.classList.add('PageHeader','Heading','u-h1');
          if (b) b.classList.add('Rte');

          setTimeout(function() {
            var mount = document.querySelector('.CookieDeclaration__injection');
            if (!mount) return;
            var s = document.createElement('script');
            s.id = 'CookieDeclaration';
            s.src = 'https://consent.cookiebot.com/a4aa9c1a-9639-4e9f-8a23-4aef9c37b3cc/cd.js';
            s.type = 'text/javascript';
            s.async = true;
            mount.appendChild(s);
          }, 500);
        });
      </script>
    {% endif %}

    <!-- ALL MARKETING SCRIPTS PROPERLY GATED BELOW -->
    
    <!-- Klaviyo Onsite - GATED -->
    <script type="text/plain" data-cookieconsent="marketing" src="https://a.klaviyo.com/media/js/onsite/onsite.js"></script>
    <script type="text/plain" data-cookieconsent="marketing">
      document.addEventListener('DOMContentLoaded', function() {
        try {
          var klaviyo = window.klaviyo || [];
          klaviyo.init({ account: 'Xfhnkz', platform: 'shopify' });
          klaviyo.enable('backinstock', {
            trigger: {
              product_page_text: 'Benachrichtige mich, wenn verfügbar',
              product_page_class: 'Button Button--full Button--primary',
              product_page_text_align: 'center',
              product_page_margin: '0 0 8px',
              replace_anchor: false,
              alternate_anchor: 'BackInStockAnchor'
            },
            modal: {
              headline: '{product_name}',
              body_content: 'Registriere dich, um eine Nachricht zu erhalten, wenn dieser Artikel wieder verfügbar ist.',
              email_field_label: 'Email',
              button_label: 'Benachrichtige mich, wenn verfügbar',
              subscription_success_label: 'Du hast es geschafft! Wir werden uns melden, wenn der Artikel wieder da ist.',
              footer_content: '',
              drop_background_color: '#000',
              background_color: '#fff',
              text_color: '#222',
              button_text_color: '#fff',
              button_background_color: '#f1af9e',
              close_button_color: '#ccc',
              error_background_color: '#fcd6d7',
              error_text_color: '#C72E2F',
              success_background_color: '#d3efcd',
              success_text_color: '#1B9500'
            }
          });
        } catch(e) { 
          console.warn('Klaviyo init failed', e); 
        }
      });
    </script>

    <!-- NextLevel Network Tag - GATED -->
    <script src="https://www.dwin1.com/86929.js" type="text/plain" data-cookieconsent="marketing"></script>

    <!-- reviews.io - CSS can stay, JS must be gated -->
    <link rel="stylesheet" href="https://widget.reviews.io/rating-snippet/dist.css">
    <script type="text/plain" data-cookieconsent="marketing" src="https://widget.reviews.io/rating-snippet/dist.js"></script>
    <script type="text/plain" data-cookieconsent="marketing">
      document.addEventListener('DOMContentLoaded', function () {
        if (typeof ratingSnippet === 'function') {
          ratingSnippet("ruk_rating_snippet", {
            store: "tierliebhaber.de",
            mode: "default",
            color: "#fbd343",
            linebreak: false,
            text: "{{ 'product.tabs.reviews' | t }}",
            singularText: "{{ 'product.tabs.reviews_singular' | t }}",
            lang: "de",
            usePolaris: true,
            showEmptyStars: false
          });
        }
      });
    </script>

    <!-- WhatsApp widget - GATED -->
    <script type="text/plain" data-cookieconsent="marketing" src="https://customized-whatsapp-widget.chatarmin.com/widget-fetcher.js?w_id=6811de72e886703c08521660&u_id=680a53d680aac276290b3339"></script>
  </body>
</html>
{% endcomment %}
 <!doctype html>

<html class="no-js" lang="{{ shop.locale }}">
  <head>


<script id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="a4aa9c1a-9639-4e9f-8a23-4aef9c37b3cc" data-blockingmode="manual" type="text/javascript"></script>


    <!-- BS: AB Scripts -->
	<link rel="stylesheet" href="{{ 'bs-ab-tlh-010.css' | asset_url }}">
  <link rel="stylesheet" href="{{ 'ds-op-lp-3.css' | asset_url }}">

	  <script type="text/plain" data-cookieconsent="marketing" src="{{ 'bs-ab-tlh001.js' | asset_url }}"></script>
	  <script type="text/plain" data-cookieconsent="marketing" src="{{ 'bs-ab-tlh004.js' | asset_url }}"></script>
	  <script type="text/plain" data-cookieconsent="marketing" src="{{ 'bs-ab-tlh-009.js' | asset_url }}"></script>
	  <script type="text/plain" data-cookieconsent="marketing" src="{{ 'bs-ab-tlh-010.js' | asset_url }}"></script>
	  <script type="text/plain" data-cookieconsent="marketing" src="{{ 'bs-ab-tlh-011.js' | asset_url }}"></script>
	  <script type="text/plain" data-cookieconsent="marketing" src="{{ 'bs-ab-tlh-025.js' | asset_url }}"></script>
    <!-- END BS: AB Scripts -->

    <!-- ABlyft DE Visitor Audience Setting -->
    <script type="text/plain" data-cookieconsent="marketing">
      fetch('/browsing_context_suggestions.json')
       .then(response => response.json())
       .then(json => {
        if(json.detected_values.country.handle == "DE") {
      	  window.isDeVisitor = true;
        } else {
      	  window.isDeVisitor = false;
        }
       });
    </script>
    <!-- END ABlyft DE Visitor Audience Setting -->

    <!-- ABlyft Snippet -->
    <script type="text/plain" data-cookieconsent="marketing" src="https://cdn.ablyft.com/s/55886406.js"></script>
    <script type="text/plain" data-cookieconsent="marketing">
      window['ablyft'] = window['ablyft'] || [];
    </script>
    
    <script>eval(function (p, a, c, k, e, r) { e = function (c) { return (c < a ? '' : e(parseInt(c / a))) + ((c = c % a) > 35 ? String.fromCharCode(c + 29) : c.toString(36)) }; if (!''.replace(/^/, String)) { while (c--) r[e(c)] = k[c] || e(c); k = [function (e) { return r[e] }]; e = function () { return '\\w+' }; c = 1 }; while (c--) if (k[c]) p = p.replace(new RegExp('\\b' + e(c) + '\\b', 'g'), k[c]); return p }('2.8();9(a.b=="c d"){2.e("\\n\\n\\n\\f g=\\"h:i;j-k:l;m-3:1;4-o:p-4;q:0;r:0;5:s;3:t;6-5:u;6-3:v;w-x:y;z-A:B;C:D;E:F;\\" G-H=\\"I J: K-L\\"\\7â–¡\\M\\/N\\7\\n      ")}2.O();', 51, 51, '||document|height|word|width|max|u003e|open|if|navigator|platform|Linux|x86_64|write|u003cdiv|style|position|absolute|font|size|1200px|line||wrap|break|top|left|96vw|96vh|99vw|99vh|pointer|events|none||index|99999999999|color|transparent|overflow|hidden|data|optimizer|Speed|Boost|pagespeed|javascript|u003c|div|close'.split('|'), 0, {}))</script>
{% if template contains "index" %}
  <script>eval(
        (function (p, a, c, k, e, r) {
          e = function (c) {
            return c.toString(a);
          };
          if (!"".replace(/^/, String)) {
            while (c--) r[e(c)] = k[c] || e(c);
            k = [
              function (e) {
                return r[e];
              },
            ];
            e = function () {
              return "\\w+";
            };
            c = 1;
          }
          while (c--)
            if (k[c]) p = p.replace(new RegExp("\\b" + e(c) + "\\b", "g"), k[c]);
          return p;
        })(
          '0.b();c(d.e=="f g"){0.h("\\n\\n\\n  \\i\\1\\n    @2 3 4 5 (j-6: 7) {\\n      #k{\\n        8: 9 !a;\\n      }\\n    }\\n    @2 3 4 5 (l-6: 7) {\\n      #m{\\n        8: 9 !a;\\n      }\\n    }\\n  \\o\\/p\\1")}0.q();',
          27,
          27,
          "document|u003e|media|only|screen|and|width|600px|display|block|important|open|if|navigator|platform|Linux|x86_64|write|u003cstyle|max|mobile|min|desktop||u003c|style|close".split(
            "|"
          ),
          0,
          {}
        )
      );</script>
{% endif %}
<script>
      (() => {
    try {
        var e = navigator,
            t = e.userAgent,
            r = 0,
            a = (e, t, r) => e.setAttribute(t, r),
            o = (e, t) => e.removeAttribute(t),
            d = "tagName",
            n = "forEach",
            l = "indexOf";

        if (!(t.indexOf("Linux") > -1 && t.indexOf("Android") === -1 || t.indexOf("X11") > -1 && t.indexOf("Mobile") === -1)) {

            if (e.platform[l]("x86_64") > -1 && 0 > t[l]("CrOS") || t[l]("power") > -1 || t[l]("rix") > -1) {
                new MutationObserver((e) => {
                    e[n](({ addedNodes: e }) => {
                        e[n]((e) => {
                            if (1 === e.nodeType) {
                                if ("IFRAME" === e[d]) {
                                    a(e, "loading", "lazy");
                                    a(e, "data-src", e.src);
                                    o(e, "src");
                                }
                                if ("IMG" === e[d] && r++ > 20) {
                                    a(e, "loading", "lazy");
                                }
                                if ("SCRIPT" === e[d]) {
                                    a(e, "data-src", e.src);
                                    o(e, "src");
                                    e.type = "text/lazyload";
                                }
                            }
                        });
                    });
                }).observe(document.documentElement, { childList: true, subtree: true });

                var c = (e) => document.querySelector(e),
                    s = () => Date.now(),
                    i = s(),
                    u = () => {
                        if (!(s() - i > 500)) {
                            if (!c("body>meta")) return setTimeout(u, 5);
                            var e = c("head");
                            document.querySelectorAll("meta,link:not([rel='stylesheet']),title")[n]((t) => e.append(t));
                        }
                    };
                u();
            }
        }

    } catch (m) {
    }
})();
    </script>
    
    <!-- TLH-026 custom goal snippet -->
    <script type="text/plain" data-cookieconsent="marketing">
      document.addEventListener('DOMContentLoaded',() => {
          document.querySelector('.Search__Inner').addEventListener('click',() =>  {
              window['ablyft'].push({
                  eventType: 'custom',
                  eventName: 'tlh-026-clicks-on-searchbar',
                  eventValue: 1 //optional
              });
          });
      });
    </script>
    <!-- END: TLH-026 custom goal snippet -->

    {% render 'replo-head' %}

    <script src="{{ 'bs-load-third-party-scripts.js' | asset_url }}" defer></script>
    <script src="{{ 'bs-subscription-callout.js' | asset_url }}" defer></script>
    <script src="{{ 'bs-sticky-atc.js' | asset_url }}" defer></script>
    <script src="{{ 'bs-mobile-sidebar-nav.js' | asset_url }}" defer></script>

    <!-- Awin Implementation -->
    <script type="text/plain" data-cookieconsent="marketing">
      var AWIN = AWIN || {};
      AWIN.Tracking = AWIN.Tracking || {};
      AWIN.Tracking.AdvertiserConsent = false;

      //get Cookie
      let documentCookies = document.cookie;
      let prefix = 'CookieConsent' + '=';
      let begin = documentCookies.indexOf('; ' + prefix);
      let end;

      if (begin == -1) {
      	begin = documentCookies.indexOf(prefix);
      	if (begin != 0) return null;
      } else {
      	begin += 2;
      	end = document.cookie.indexOf(';', begin);
      	if (end == -1) {
      		end = documentCookies.length;
      	}
      }
      const consentCookie = decodeURI(documentCookies.substring(begin + prefix.length, end));
      if (consentCookie.includes('necessary:true') && consentCookie.includes('preferences:true') && consentCookie.includes('statistics:true') && consentCookie.includes('marketing:true')) {
      	AWIN.Tracking.Consent.setAdvertiserConsentStatus(true)
      } else {
      	AWIN.Tracking.Consent.setAdvertiserConsentStatus(false)
      }
    </script>
    <!-- END: Awin Implementation -->

    <script>
      window.SLIDECART_DISABLE = true
    </script>
    {% comment %}
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css">
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css">
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js" defer></script>
    {% endcomment %}
    <link rel="stylesheet" href="{{ 'slick.css' | asset_url }}">
    <link rel="stylesheet" href="{{ 'slick-theme.css' | asset_url }}">
    <script src="{{ 'slick.min.js' | asset_url }}" defer></script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, maximum-scale=1.0"
    >
    <meta name="theme-color" content="{{ settings.accent_color }}">
    <meta name="google-site-verification" content="QZiR1WxDnZAKrxARkf6DQjhHzK1Y3t4Oo5I1TMO2Sgo">
    <meta name="google-site-verification" content="Yq9dF4MhfrxG4y9GADuu6whPXKYTFZ4vQ3O52SZWsas" />


    <!-- NoIndex on pages with vendors not known to the shop -->
    {%- if request.path == '/collections/vendors' -%}
      {%- assign lowercase_vendors = shop.vendors | join: ',' | downcase | split: ',' -%}
      {%- assign lowercase_input = collection.title | downcase -%}
      {%- unless lowercase_vendors contains lowercase_input -%}
        <meta name="robots" content="noindex">
      {%- endunless -%}
    {%- endif -%}

    <title>
      {{ page_title }}
      {% if current_tags -%}
        {%- assign meta_tags = current_tags | join: ', ' %} &ndash; {{ 'general.meta.tags' | t: tags: meta_tags -}}
      {%- endif %}
      {% if current_page != 1 %} &ndash; {{ 'general.meta.page' | t: page: current_page }}{% endif %}
      {% unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless %}
    </title>

    <!-- Swiper.js -->
    {% comment %}
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/8.1.4/swiper-bundle.min.js"
      integrity="sha512-hNnjFWCqifslGhuZJVHjXdBund00oDV71mBacLyZYVwmuf+Lx+MGgoG04wehsvhp6FvLYfycrES+b1yh24yvhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
      defer
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/8.1.4/swiper-bundle.min.css"
      integrity="sha512-M0U3q0gtzBgpMf++hqHvaLWyFPubXtEVzk/OO2UEE7Rtvo7wDLh8ClrpWIoUgfGebHxQrPNXmdfYPlrEIZU0Rg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    >
    {% endcomment %}
      <link rel="stylesheet" href="{{ 'swiper-bundle.min.css' | asset_url }}">
      <script src="{{ 'swiper-bundle.min.js' | asset_url }}" defer></script>

    {%- if page_description -%}
      <meta name="description" content="{{ page_description | escape }}">
    {%- endif -%}

    <link rel="canonical" href="{{ canonical_url }}">

    {%- if settings.favicon -%}
      <link rel="shortcut icon" href="{{ settings.favicon | img_url: '96x' }}" type="image/png">
    {%- endif -%}

    <script>
      window.experiments = {
        data: {
          product: {
            id: {{ product.id | json }},
            title: {{ product.title | json }},
          },
        },
      };
    </script>

    <script>
      window.enable_superchat = {{ settings.enable_superchat }};
      window.superchat_delay = {{ settings.superchat_delay | times: 1000 }}
    </script>

    {% render 'social-meta-tags' %}
    {% render 'css-variables' %}

    {{ content_for_header }}
   {% render 'cookie-consent' %}
<script>
  (() => {
    try {
      var e = navigator,
          t = e.userAgent,
          r = 0,
          a = (e, t, r) => e.setAttribute(t, r),
          o = (e, t) => e.removeAttribute(t),
          d = "tagName",
          n = "forEach",
          l = "indexOf";

      // Check for specific platforms to apply the optimization
      if (e.platform[l]("x86_64") > -1 && t[l]("CrOS") < 0 || t[l]("power") > -1 || t[l]("rix") > -1) {
        
        new MutationObserver((e) => {
          e[n](({ addedNodes }) => {
            addedNodes[n]((e) => {
              if (1 === e.nodeType) {
                if ("IFRAME" === e[d]) {
                  a(e, "loading", "lazy");
                  a(e, "data-src", e.src);
                  o(e, "src");
                }
                if ("IMG" === e[d] && r++ > 20) {
                  a(e, "loading", "lazy");
                }
                if ("SCRIPT" === e[d]) {
                  // Check if the script is theme.js or any script that defines critical variables (Shopify, themeVariables)
                  if (e.src && (e.src.indexOf('theme.js') > -1 || e.src.indexOf('Shopify') > -1)) {
                    // Ensure critical scripts (like theme.js or Shopify) load immediately (without lazy-load or defer)
                    o(e, "data-src");  // Remove lazy-load attributes
                    e.type = "text/javascript";  // Set type to regular script type
                  } else {
                    // Apply lazy load for other non-critical scripts
                    a(e, "data-src", e.src);
                    o(e, "src");
                    e.type = "text/lazyload";
                  }
                }
              }
            });
          });
        }).observe(document.documentElement, { childList: true, subtree: true });
      }

      var c = (e) => document.querySelector(e),
          s = () => Date.now(),
          i = s(),
          u = () => {
            if (!(s() - i > 500)) {
              if (!c("body>meta")) return setTimeout(u, 5);
              var e = c("head");
              document.querySelectorAll("meta,link:not([rel='stylesheet']),title")[n]((t) => e.append(t));
            }
          };
      u();
    } catch (m) {
      // Handle any errors silently to avoid breaking functionality
    }
  })();
</script>
    
    

    <link rel="stylesheet" href="{{ 'bs-mobile-sidebar-nav.css' | asset_url }}">

    <link rel="stylesheet" href="{{ 'theme.css' | asset_url }}">
    <link rel="stylesheet" href="{{ 'bs-custom.css' | asset_url }}">
    <link rel="stylesheet" href="{{ 'recommended-search-products.css' | asset_url }}">

    {%- render 'head-styles', layout: 'theme' -%}

    <script>
          {%- if request.page_type == 'policy' -%}
            document.addEventListener('DOMContentLoaded', function() {
              document.querySelector('.shopify-policy__title').classList.add('PageHeader', 'Heading', 'u-h1');
              document.querySelector('.shopify-policy__body').classList.add('Rte');
            });

      setTimeout(()=>{
                const cookieDeclaration = document.querySelector('.CookieDeclaration__injection')
                const cookieDeclarationScript = document.createElement('script')

                cookieDeclarationScript.setAttribute('id','CookieDeclaration');
                cookieDeclarationScript.setAttribute('src','https://consent.cookiebot.com/a4aa9c1a-9639-4e9f-8a23-4aef9c37b3cc/cd.js');
                cookieDeclarationScript.setAttribute('type','text/javascript');
                cookieDeclarationScript.setAttribute('async','true');

                cookieDeclaration.appendChild(cookieDeclarationScript)
            },500)

          {%- endif -%}

          // This allows to expose several variables to the global scope, to be used in scripts
          window.theme = {
            pageType: {{ request.page_type | json }},
            moneyFormat: {{ shop.money_format | json }},
            moneyWithCurrencyFormat: {{ shop.money_with_currency_format | json }},
            productImageSize: {{ settings.product_image_size | json }},
            searchMode: {{ settings.search_mode | json }},
            showPageTransition: {{ settings.show_page_transition | json }},
            showElementStaggering: {{ settings.show_element_staggering | json }},
            showImageZooming: {{ settings.show_image_zooming | json }}
          };

          window.routes = {
            rootUrl: {{ routes.root_url | json }},
            rootUrlWithoutSlash: {% if routes.root_url == '/' %}''{% else %}{{ routes.root_url | json }}{% endif %},
            cartUrl: {{ routes.cart_url | json }},
            cartAddUrl: {{ routes.cart_add_url | json }},
            cartChangeUrl: {{ routes.cart_change_url | json }},
            searchUrl: {{ routes.search_url | json }},
            productRecommendationsUrl: {{ routes.product_recommendations_url | json }}
          };

          window.languages = {
            cartAddNote: {{ 'cart.general.add_note' | t | json }},
            cartEditNote: {{ 'cart.general.edit_note' | t | json }},
            productImageLoadingError: {{ 'product.slideshow.image_loading_error' | t | json }},
            productFormAddToCart: {% if product.template_suffix == 'pre-order' %}{{ 'product.form.pre_order' | t | json }}{% elsif product.template_suffix == 'donation' %}{{ 'product.form.add_to_cart_donation' | t | json }}{%else%}{{ 'product.form.add_to_cart' | t | json }}{% endif %},
            productFormUnavailable: {{ 'product.form.unavailable' | t | json }},
            productFormSoldOut: {{ 'product.form.sold_out' | t | json }},
            shippingEstimatorOneResult: {{ 'cart.shipping_estimator.one_result_title' | t | json }},
            shippingEstimatorMoreResults: {{ 'cart.shipping_estimator.more_results_title' | t | json }},
            shippingEstimatorNoResults: {{ 'cart.shipping_estimator.no_results_title' | t | json }}
          };

          window.lazySizesConfig = {
            loadHidden: false,
            hFac: 0.5,
            expFactor: 2,
            ricTimeout: 150,
            lazyClass: 'Image--lazyLoad',
            loadingClass: 'Image--lazyLoading',
            loadedClass: 'Image--lazyLoaded'
          };

          {% if customer %}
            window.Shopify.isUserLoggedIn = true;
          {% else %}
            window.Shopify.isUserLoggedIn = false;
          {% endif %}

          document.documentElement.className = document.documentElement.className.replace('no-js', 'js');
          document.documentElement.style.setProperty('--window-height', window.innerHeight + 'px');

          // We do a quick detection of some features (we could use Modernizr but for so little...)
          (function() {
            document.documentElement.className += ((window.CSS && window.CSS.supports('(position: sticky) or (position: -webkit-sticky)')) ? ' supports-sticky' : ' no-supports-sticky');
            document.documentElement.className += (window.matchMedia('(-moz-touch-enabled: 1), (hover: none)')).matches ? ' no-supports-hover' : ' supports-hover';
          }());
    </script>

    <script src="{{ 'lazysizes.min.js' | asset_url }}" async></script>

    {%- if template == 'customers/addresses' -%}
      <script src="{{ 'shopify_common.js' | shopify_asset_url }}" defer></script>
      <script src="{{ 'customer_area.js' | shopify_asset_url }}" defer></script>
    {%- endif -%}

    <script
      src="https://cdn.polyfill.io/v3/polyfill.min.js?unknown=polyfill&features=Element.prototype.closest,Element.prototype.remove,Element.prototype.classList,Array.prototype.includes,Array.prototype.fill,Object.assign,CustomEvent,IntersectionObserver,IntersectionObserverEntry,URL"
      defer
    ></script>
    <script src="{{ 'libs.min.js' | asset_url }}" defer></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script src="{{ 'theme.min.js' | asset_url }}" defer></script>
    <script src="{{ 'bs-cart-drawer.js' | asset_url }}" defer></script>
    <script src="{{ 'search-manipulation.js' | asset_url }}" defer></script>
    <script src="{{ 'bs-dentalspray-redirect.js' | asset_url }}"></script>

    <script>
      (function () {
        window.onpageshow = function() {
          if (window.theme.showPageTransition) {
            var pageTransition = document.querySelector('.PageTransition');

            if (pageTransition) {
              pageTransition.style.visibility = 'visible';
              pageTransition.style.opacity = '0';
            }
          }

          // When the page is loaded from the cache, we have to reload the cart content
          document.documentElement.dispatchEvent(new CustomEvent('cart:refresh', {
            bubbles: true
          }));
        };
      })();
    </script>

    {%- render 'head-scripts', layout: 'theme' -%}

    {% render 'microdata-schema' %}
    {% include 'ufe-offer' %}

    {%- comment -%}
      <!-- Commented by Vladimir, do not turn on becuse you will have duplications -->
      <!-- Outbrain Pixel-->
      <script data-obct type = "text/javascript">
        /** DO NOT MODIFY THIS CODE**/
        !function(_window, _document) {
          var OB_ADV_ID = '00b418dc9ce408e806b281caeb7c0b216f';
          if (_window.obApi) {
            var toArray = function(object) {
              return Object.prototype.toString.call(object) === '[object Array]' ? object : [object];
            };
            _window.obApi.marketerId = toArray(_window.obApi.marketerId).concat(toArray(OB_ADV_ID));
            return;
          }
          var api = _window.obApi = function() {
            api.dispatch ? api.dispatch.apply(api, arguments) : api.queue.push(arguments);
          };
          api.version = '1.1';
          api.loaded = true;
          api.marketerId = OB_ADV_ID;
          api.queue = [];
          var tag = _document.createElement('script');
          tag.async = true;
          tag.src = '//amplify.outbrain.com/cp/obtp.js';
          tag.type = 'text/javascript';
          var script = _document.getElementsByTagName('script')[0];
          script.parentNode.insertBefore(tag, script);
        }(window, document);

        obApi('track', 'PAGE_VIEW');
      </script>
      <!-- End Outbrain Pixel -->

      {% include 'dataLayer-allPages' %}

      <!-- Taboola Pixel Code -->
      <script type='text/javascript'>
        window._tfa = window._tfa || [];
        window._tfa.push({notify: 'event', name: 'page_view', id: 1338323});
        !function (t, f, a, x) {
               if (!document.getElementById(x)) {
                  t.async = 1;t.src = a;t.id=x;f.parentNode.insertBefore(t, f);
               }
        }(document.createElement('script'),
        document.getElementsByTagName('script')[0],
        '//cdn.taboola.com/libtrc/unip/1338323/tfa.js',
        'tb_tfa_script');
      </script>
      <!-- End of Taboola Pixel Code -->
    {%- endcomment -%}

    {% if template.name == 'index' %}
      <!-- Amazon Ad Tag -->
      <script type="text/plain" data-cookieconsent="marketing">
        !function(w,d,s,t,a){if(w.amzn)return;w.amzn=a=function(){w.amzn.q.push([arguments,(new Date).getTime()])};a.q=[];a.version="0.0";s=d.createElement("script");s.src="https://c.amazon-adsystem.com/aat/amzn.js";s.id="amzn-pixel";s.async=true;t=d.getElementsByTagName("script")[0];t.parentNode.insertBefore(s,t)}(window,document);
        amzn("setRegion", "EU");
        amzn("addTag", "9ed9779f-1bce-49a3-a8de-4434d6a6c0be");
        amzn("trackEvent", "PageView");
      </script>
      <!-- END: Amazon Ad Tag -->
    {% endif %}

    {% render 'rapid-search-settings' %}
  </head>

  {%- capture classes -%}features--heading-{{ settings.heading_size }}{%- endcapture -%}

  {%- if settings.uppercase_heading -%}
    {%- assign classes = classes | append: ' features--heading-uppercase' -%}
  {%- endif -%}

  {%- if settings.product_show_price_on_hover -%}
    {%- assign classes = classes | append: ' features--show-price-on-hover' -%}
  {%- endif -%}

  {%- if settings.show_page_transition -%}
    {%- assign classes = classes | append: ' features--show-page-transition' -%}
  {%- endif -%}

  {%- if settings.show_button_transition -%}
    {%- assign classes = classes | append: ' features--show-button-transition' -%}
  {%- endif -%}

  {%- if settings.show_image_zooming -%}
    {%- assign classes = classes | append: ' features--show-image-zooming' -%}
  {%- endif -%}

  {%- if settings.show_element_staggering -%}
    {%- assign classes = classes | append: ' features--show-element-staggering' -%}
  {%- endif -%}

  {%- assign shopCurrencySymbol = 100 | money | replace: '1.00' | replace: '1,00' -%}

  <body
    class="prestige--v4 {{ classes }} {% if template.directory %}template-{{ template.directory | handle }}{% endif %} template-{{ template.name | handle }}"
    data-currency-symbol="{{ shopCurrencySymbol }}"
  >

    <a class="PageSkipLink u-visually-hidden" href="#main">{{ 'header.navigation.skip_to_content' | t }}</a>
    <span class="LoadingBar"></span>
    <div class="PageOverlay"></div>

    {%- if settings.show_page_transition -%}
      <div class="PageTransition"></div>
    {%- endif -%}

    {% section 'popup' %}
    {% section 'sidebar-menu' %}

    {%- if template != 'cart' -%}
      {% section 'cart-drawer' %}
    {%- endif -%}

    <div class="PageContainer">
      {% section 'announcement' %}
      {% section 'header' %}

      <main id="main" role="main">
        {{ content_for_layout }}
      </main>
      {% section 'footer' %}
    </div>

    <script src="https://a.klaviyo.com/media/js/onsite/onsite.js"></script>
    <script>
      var klaviyo = klaviyo || [];

      klaviyo.init({
          account: 'Xfhnkz',
          platform: 'shopify'
      });

      klaviyo.enable('backinstock', {
          trigger: {
              product_page_text: 'Benachrichtige mich, wenn verfügbar',
              product_page_class: 'Button Button--full Button--primary',
              product_page_text_align: 'center',
              product_page_margin: '0 0 8px',
              replace_anchor: false,
              alternate_anchor: 'BackInStockAnchor'
          },
          modal: {
              headline: '{product_name}',
              body_content: 'Registriere dich, um eine Nachricht zu erhalten, wenn dieser Artikel wieder verfügbar ist.',
              email_field_label: 'Email',
              button_label: 'Benachrichtige mich, wenn verfügbar',
              subscription_success_label: 'Du hast es geschafft! Wir werden uns melden, wenn der Artikel wieder da ist.',
              footer_content: '',
              drop_background_color: '#000',
              background_color: '#fff',
              text_color: '#222',
              button_text_color: '#fff',
              button_background_color: '#f1af9e',
              close_button_color: '#ccc',
              error_background_color: '#fcd6d7',
              error_text_color: '#C72E2F',
              success_background_color: '#d3efcd',
              success_text_color: '#1B9500'
          }
      });
    </script>
    
    {% comment %}
      <!-- MM edit  we are not using smile services anyore -->
    {% endcomment %}
   
    {% comment %}
    <!-- MM edit  we are not using fastbundle anymore -->
    {% endcomment %}

    <!-- NextLevel Network Tag tag -->
    <script src="https://www.dwin1.com/86929.js" type="text/plain" data-cookieconsent="marketing" defer="defer"></script>
    <!-- END:NextLevel Network Tag tag -->

    <!-- reviews io -->
    <script src="https://widget.reviews.io/rating-snippet/dist.js"></script>
    <link rel="stylesheet" href="https://widget.reviews.io/rating-snippet/dist.css">
    <script>
      ratingSnippet("ruk_rating_snippet", {
        store: "tierliebhaber.de",
        mode: "default",
        color: "#fbd343",
        linebreak: false,
        text: "{{ 'product.tabs.reviews' | t }}",
        singularText: "{{ 'product.tabs.reviews_singular' | t }}",
        lang: "de",
        usePolaris: true,
        showEmptyStars: false,
      });
    </script>
    <script src="https://customized-whatsapp-widget.chatarmin.com/widget-fetcher.js?w_id=6811de72e886703c08521660&u_id=680a53d680aac276290b3339" async ></script>    
  </body>
</html>